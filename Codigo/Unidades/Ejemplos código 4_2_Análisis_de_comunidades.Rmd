---
title: "Ejemplo código Análisi de comunidades"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(vegan)
```

#Riqueza de especies

Se utiliza la función specnumber() de la librería "vegan" para calcular la riqueza de especies a partir de los datos.Ten en cuenta que specnumber() simplemente cuenta el número total de especies presentes en los datos. Si deseas calcular la riqueza de especies en cada comunidad individualmente, puedes utilizar la función specaccum() en su lugar.

```{r}
# Cargar la librería "vegan"
library(vegan)

# Cargar datos de ejemplo
data( )

# Calcular la riqueza de especies
species_richness <- specnumber( )

# Imprimir la riqueza de especies
species_richness
```


#Curva de acumulación de Riqueza
Se utiliza la función specaccum() de la librería "vegan" para calcular la curva de acumulación de riqueza de especies a partir de una serie de datos, luego, se grafica la curva utilizando la función plot(), con los ejes x e y etiquetados y un título para la gráfica.

```{r}
# Cargar la librería "vegan"
library(vegan)

# Cargar datos de 
data( )

# Calcular la curva de acumulación de riqueza de especies
acum_richness <- specaccum( )

# Graficar la curva de acumulación de riqueza de especies
plot(acum_richness, xlab = "Número de muestras", ylab = "Riqueza acumulada",
     main = "Curva de acumulación de riqueza de especies")
```

#Rarefacción de riqueza
se utiliza la función rarecurve() de la librería "vegan" para calcular la curva de rarefacción de riqueza a partir de los datos. Luego, se grafica la curva utilizando la función plot(), con los ejes x e y etiquetados y un título para la gráfica. 
```{r}
# Cargar la librería "vegan"
library(vegan)

# Cargar datos de ejemplo
data( )

# Calcular la curva de rarefacción de riqueza
rare_richness <- rarecurve( )

# Graficar la curva de rarefacción de riqueza
plot(rare_richness, xlab = "Número de muestras", ylab = "Riqueza",
     main = "Curva de rarefacción de riqueza")
```

# Diversidad Alfa
Se utiliza la función diversity() de la librería "vegan" para calcular la diversidad alfa de especies a partir de los datos. 
La diversidad se calcula utilizando el índice de diversidad de Shannon por defecto. 
Los valores de diversidad alfa se imprimen en la consola.
Si deseas calcular la diversidad alfa de especies para cada comunidad individualmente, puedes agregar el argumento index y especificar un índice de diversidad diferente.  En este ejemplo, se calcula la diversidad alfa de especies utilizando el índice de Simpson para cada comunidad en la base de datos, y los valores se imprimen en la consola.
```{r}
# Cargar la librería "vegan"
library(vegan)

# Cargar datos de ejemplo
data( )

# Calcular la diversidad alfa de especies
div_alfa <- diversity( )

# Imprimir los valores de diversidad alfa
div_alfa

# Calcular la diversidad alfa de especies para cada comunidad
div_alfa_com <- diversity(base de datos , index = "simpson")

# Imprimir los valores de diversidad alfa para cada comunidad
div_alfa_com
```

#Diversidad Beta
se utiliza la función betadisper() de la librería "vegan" para calcular la diversidad beta de especies a partir de los datos de ejemplo dune. Los valores de diversidad beta se imprimen en la consola. Además, se utiliza la función plot() para graficar los resultados. El gráfico muestra la variabilidad de la composición de especies entre las comunidades.
Ten en cuenta que betadisper() se utiliza para analizar la variabilidad de la composición de especies entre diferentes grupos o comunidades. Si deseas analizar la similitud entre las comunidades, puedes utilizar otras funciones de la librería "vegan", como vegdist() y mantel() para realizar un análisis de similitud y correlación entre matrices.
```{r}
# Cargar la librería "vegan"
library(vegan)

# Cargar datos de ejemplo
data( )

# Calcular la diversidad beta de especies
beta_div <- betadisper( )

# Imprimir los valores de diversidad beta
beta_div

# Graficar los resultados
plot(beta_div, main = "Diversidad beta de especies")
```


# EJEMPLO DE OSCAR

```{r}
# library(BiodiversityR)
library(vegan)
#BASE DE DATOS
pd <- read.csv("../../Datos/Plant species errors fixed.csv", header = T, stringsAsFactors = T)
#Formar una tabla
pd.t <- ftable(Site ~Species,data = pd)
#Medir Riqueza
colSums(pd.t)
#Pedir los nombres de las columnas
levels(pd$Site)
s <- specnumber(t(pd.t),)
names(s) <- levels(pd$Site)
```

```{r}
#Nueva base de datos
gb.biol <- read.csv("../../Datos/Ground Beetles and abundance.csv",row.names = 1)
dim(gb.biol)
range(rowSums(gb.biol))
rarefy(gb.biol,sample = 205)
drarefy(gb.biol,sample = 205)
```

```{r curva de acumulacion de especies}
### CURVA DE ACUMULACIÓN DE ESPECIES ###
gb.sa <- specaccum(gb.biol,method = "collector")
gb.sa$richness

plot(gb.sa)
```


```{r}
gb.site <- read.csv("../../Datos/GBsite.csv",row.names=1)

head(gb.site)

ac <- accumcomp(x = gb.biol,y=gb.site,factor = "Habitat", 
                plotit = T, rainbow = F,legend = F, xlim = c(0,7))

gb.sa2 <- as.data.frame(gb.sa)
```



```{r}
###Estimacion de Riqueza ###
library(fossil)
est <- spp.est(t(gb.biol),rand=100, abund = T)
gb.site
library(ggplot2)
edge.sp <- data.frame(spp.est(t(gb.site),rand = 100, abund = T), 
                      Acumulacion = edge.ac$richeness, 
                      Habitat = rep("Edge",nrow(gb.edge))plot=T)

ggplot(gb.sa,aes(gb.sa$richeness,)) +geom_point() 
   + facet_wrap(~Habitat)

ac <- accumcomp(x = gb.biol,y=gb.site,factor = "Habitat", 
                plotit = T, rainbow = F,legend = F, xlim = c(0,7))


### Curvas de Rango de Abundancia ###

# 1.- Estandarizar matriz
gb.biol
gb.ra <- rrarefy(gb.biol,sample = 205)

#Rangos de abundancia
gb.rank <- rankabundance(gb.biol)
gb.rank <- rankabundance(gb.biol)

diversity (gb.biol,index = "shannon")

#JACCARD
gb.j <- betadiver(gb.biol,"j")

#representar denogrmas (matriz de distancia de los indices de jjaccard)
plot(hclust(gb.j),hang=-1)

#graficar valores inversos (en función de lo que se parece)
plot(hclust(1-gb.j),hang=-1)

#Suma de fila por Habitat
gbt <- rowsum(gb.biol,group= gb.site$Habitat)
gbt [1:8]

#calcular diversidad
gb.j <- betadiver(gbt, "j")
plot(hclust(1-gb.j),hang=-1)

###DIVERSIDAD BETA
library(betapart)
gb.tp <- gbt
gb.biol[gb.biol>0]<-1
gb.biol[,1:8]
beta.multi(gb.biol,index.family = "sorense")

#explorar elementos de la b. diversidad , calcula por tipo de habitat
beta.pair(gb.biol,index.family = "sorensen")


```


EJEMPLO 2 de código de la clase práctica de Oscar
```{r}
### Grafica de  curva de acumulación , PRACTICA ##
#Librerias
library(BiodiversityR)
library(vegan)
library(fossil)
library(ggplot2)
library(dplyr)
library(tidyverse)


gb.biol <- read.csv("Ground Beetles and abundance.csv",row.names = 1)

# 1.- Filtra base de datos gb.biol
E <- gb.biol [1:6,]
G <- gb.biol [7:12,]
W <- gb.biol[13:18,]

# 2.- sacar Riqueza
E.ac <- specaccum(E, method = "collector")
G.ac <- specaccum(G, method = "collector")
W.ac <- specaccum(W, method = "collector")

# 3.- Sacar acumulación
E.est <- spp.est(t(E), rand = 100, abund = T)
G.est <- spp.est(t(G), rand = 100, abund = T)
W.est <- spp.est(t(W), rand = 100, abund = T)

# 4.- pegar las bases de datos
df <- rbind(E.est, G.est, W.est)
df <- as.data.frame(df)
df <- cbind(df,gb.site$Habitat)

# 5.- seleccionar base de datos
df2 <- df %>% select (N.obs, S.obs,  Chao1,  Jack1 ,`gb.site$Habitat`)%>% gather("variable", "valor",2:4)
# 6.- Graficar

ggplot(df2,aes(N.obs,valor,group=variable,col=variable,lty=variable)) + geom_line()+ facet_wrap(~gb.site$Habitat)
```


```{r}
#Medir Riqueza
colSums(mosquitos.tabla)

#Pedir los nombres de las columnas
s <- specnumber(t(mosquitos.tabla),)
s.names <- names(s) <- levels(mosquitos$SITIO)
s.mosquits <- specaccum(mosquitos,method = "collector")
```


```{r}
gb.biol <- read.csv("Ground Beetles and abundance.csv",row.names = 1)
dim(gb.biol)
range(rowSums(gb.biol))
rarefy(gb.biol,sample = 205)
drarefy(gb.biol,sample = 205)

# CURVA DE ACUMULACIÓN DE ESPECIES
gb.sa <- specaccum(gb.biol,method = "collector")
gb.sa
gb.sa$richness
plot(gb.sa)
gb.site <- read.csv("GBsite.csv",row.names=1)
head(gb.site)
ac <- accumcomp(x = gb.biol,y=gb.site,factor = "Habitat", plotit = T, rainbow = F,legend = F, xlim = c(0,7))
ac
gb.sa2 <- as.data.frame(gb.sa)
```


